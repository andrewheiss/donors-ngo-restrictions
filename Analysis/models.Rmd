---
title: "Models"
author: "Suparna Chaudhry and Andrew Heiss"
date: "`r format(Sys.time(), '%B %e, %Y')`"
output: 
  html_document: 
    code_folding: hide
    css: ../html/fixes.css
    fig_height: 3.5
    fig_width: 5
    highlight: pygments
    includes:
      after_body: ../html/add_home_link.html
    theme: spacelab
    toc: yes
    toc_depth: 4
    toc_float: yes
---

```{r load-libraries, message=FALSE}
knitr::opts_chunk$set(cache=FALSE, fig.retina=2,
                      tidy.opts=list(width.cutoff=120),  # For code
                      options(width=120))  # For output

library(tidyverse)
library(stringr)
library(forcats)
library(stargazer)
library(lme4)

source(file.path(PROJHOME, "lib", "graphics.R"))
source(file.path(PROJHOME, "lib", "pandoc.R"))
source(file.path(PROJHOME, "lib", "bayes.R"))

my.seed <- 1234
set.seed(my.seed)
```

```{r load-data, cache=TRUE, message=FALSE}
df.donor.country <- readRDS(file.path(PROJHOME, "Data", "data_clean",
                                      "df_donor_country.rds"))
df.donor <- readRDS(file.path(PROJHOME, "Data", "data_clean",
                              "df_donor.rds"))
df.country <- readRDS(file.path(PROJHOME, "Data", "data_clean",
                                "df_country.rds"))
df.country.aid <- readRDS(file.path(PROJHOME, "Data", "data_clean",
                                "df_country_aid.rds"))

df.country.aid.demean <- df.country.aid %>%
  group_by(cowcode) %>%
  mutate_at(vars(barriers.total, advocacy, entry, funding, 
                 polity, gdp.capita, trade.pct.gdp, corruption),
            funs(between = mean(., na.rm=TRUE),  # meaned
                 within = . - mean(., na.rm=TRUE)))  # demeaned

dcjw.questions.clean <- read_csv(file.path(PROJHOME, "Data", "data_clean",
                                           "dcjw_questions.csv"))
dcjw.responses.clean <- read_csv(file.path(PROJHOME, "Data", "data_clean",
                                           "dcjw_responses.csv"))
```

## H~1~: Donors reduce aid in response to legislation

> **H~1~**: In response to restrictive NGO legislation, bilateral, multilateral, and private donors may reduce their aid to repressive countries.

$$ln( \text{ODA} )_{i, t+1} = \text{NGO legislation}_{it} + \text{controls}_{it}$$

Our dependent variable for this hypothesis is the log of ODA (constant 2011 dollars), leaded by one year so we don't have to lag every other independent variable. 

We look at NGO legislation in a few different ways:

- `barriers.total`: Number of anti-NGO legal barriers in a country-year
- `barriers.total_new`: Indicator marking if a new anti-NGO barrier was passed in a country year
- `advocacy + entry + funding`: Number of anti-NGO legal barriers by type of barrier
- `advocacy_new + entry_new + funding_new`: Indicators marking new type of barrier

We use a standard set of controls in each model ([explained in more detail here](/Data/get_merge_data.html#other_controls_and_alternative_hypotheses)):

- Democracy: `polity`
- Wealth: `gdp.capita`
- Government capacity: `corruption`
- Bad stuff: `internal.conflict.past.5` and `natural_disaster.occurrence`

Following Bell and Jones (2012), we use random effects for country and year and use a combination of meaned and demeaned versions of each continuous variable to estimate both the within and between effects of each variable. 

$$ y_{i, t + 1} = \beta_0 + \beta_1 (x_{it} - \bar{x}_i) + \beta_2 \bar{x}_i + \ldots  $$

This approach has multiple benefits. The coefficients for the demeaned variables are roughly equivalent to their corresponding coefficeints in a fixed effects model, but a fixed effects model assumes that the between effect (captured by the mean variables) is 0, which is not the case. A random effects model specified in this manner is more interpretable, as it clearly separates the within and between effects (again, within = demeaned, between = mean).

```{r h1-models, warning=FALSE, message=FALSE}
mod.h1.barriers.total <- glmer(
  total.oda_log_next_year ~ 
    barriers.total_between + barriers.total_within +
    polity_between + polity_within + 
    gdp.capita_between + gdp.capita_within +
    trade.pct.gdp_between + trade.pct.gdp_within + 
    corruption_between + corruption_within +
    # Indicator variables don't need to be demeaned
    internal.conflict.past.5 + natural_disaster.occurrence +
    (1 | cowcode) + (1 | year),
  data=df.country.aid.demean, family=gaussian())

mod.h1.barriers.new <- glmer(
  total.oda_log_next_year ~ 
    barriers.total_new +
    polity_between + polity_within + 
    gdp.capita_between + gdp.capita_within +
    trade.pct.gdp_between + trade.pct.gdp_within + 
    corruption_between + corruption_within +
    # Indicator variables don't need to be demeaned
    internal.conflict.past.5 + natural_disaster.occurrence +
    (1 | cowcode) + (1 | year),
  data=df.country.aid.demean, family=gaussian())

mod.h1.type.total <- glmer(
  total.oda_log_next_year ~ 
    advocacy_between + advocacy_within +
    entry_between + entry_within +
    funding_between + funding_within +
    polity_between + polity_within + 
    gdp.capita_between + gdp.capita_within +
    trade.pct.gdp_between + trade.pct.gdp_within + 
    corruption_between + corruption_within +
    # Indicator variables don't need to be demeaned
    internal.conflict.past.5 + natural_disaster.occurrence +
    (1 | cowcode) + (1 | year),
  data=df.country.aid.demean, family=gaussian())

mod.h1.type.new <- glmer(
  total.oda_log_next_year ~ 
    advocacy_new + entry_new + funding_new +
    polity_between + polity_within + 
    gdp.capita_between + gdp.capita_within +
    trade.pct.gdp_between + trade.pct.gdp_within + 
    corruption_between + corruption_within +
    # Indicator variables don't need to be demeaned
    internal.conflict.past.5 + natural_disaster.occurrence +
    (1 | cowcode) + (1 | year),
  data=df.country.aid.demean, family=gaussian())
```

```{r, results="asis"}
stargazer(mod.h1.barriers.total, mod.h1.barriers.new, 
          mod.h1.type.total, mod.h1.type.new, type="html", omit="factor")
```

